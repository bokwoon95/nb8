schema.go
fs.go
notebrew.go
error.go
template.go
signup.go
login.go
logout.go
resetpassword.go
folder.go
file.go
...
server.go
notebrew/main.go

TODO: for file.html, if the current file is an asset (e.g. a JS script) to a post or page, include a link to that post/page.
TODO: for file.html, if the current file is a post or page then include the asset manager
TODO: how do I know if the current file in file.html has assets or not? How to expose it to the template? I need to hide the assets segment for all files without assets.
TODO: convert repeating elements to all use <ul> and <li> (if it make sense for a screen reader to be able to tell how many items are in the list).

/ => clipboard, create (site), search
notes/ => clipboard, sort, search, create (note | folder)
pages/ => clipboard, search, create (page | folder)
posts/ => search, create post, create category
themes/ =>
output/ =>
file.html => <input="file" name="files" multiple>, <input="text" name="file_name">
    file.html is the body of the content followed by the asset manager, which is a grid of images and files (if it's a non-image file, the tile shows the file name instead)
    TODO: We can do this part first! Sketch out the MVP by hardcoding the HTML!
ooh yeah if the current file is an asset of a post or page, show a link back to the post/page source (so users can edit a script, then pop back to the page and continue editing it. they can toggle between page source and script via the asset manager/page source link)
    for each tile in the asset grid, there is a dropdown ellipsis with an "edit" link and an "insert" button. Link and button, to clearly show one directs to a new page and the other does a thing on the page. Oh no what about the other links masquerading as buttons? It's fine they all change the page, which is like a link.
    What if... a user uploads an image and it automatically gets appended into the file? Too much? What about css/js files? They automatically get inserted into the page? Maybe have a "copy" button and an "edit" button per tile instead?
    No no no. What if they always upload an image, then rename it immediately? If we automatically insert img tags then the src will always be out of date. Don't do extra work, just upload the file and that's it. Then how do we make it obvious that the user can upload images?
        Answer: they don't. it's not obvious, you can only teach them once and hope they internalize it.
        Revised answer: Actually, remove the ability to create and upload files manually in the output directory. Creating images and scripts will be managed solely through the file.html of the page or post. Output will be a read-only directory.
        Revised revised answer: users will only be able to create/upload files in the output/themes/ directory. in the output/ directory, everything is read-only and only the search button is present. clicking on an item (list, not grid) will link directly to the cdn url. in the case of html files, the content-type will be set ton text/plain instead (this should be a cdn.nbrew.io thing instead of being handled by notebrew.com/admin/ directly) so that users will be able to preview the raw html output instead of a webpage.
        asset manager no more grid view: just a preview/icon, a plaintext name followed by edit/view | insert. im still very worries that insert (which looks like a link) will not be understood.
folder.html => expose forms with file/text inputs that POST to /admin/uploadfile/ and /admin/createfile/ respectively. No need for a separate /admin/uploadfile/ or /admin/createfile/ form anymore.
    - with great convenience comes great responsibility, now if there are form errors you need to redirect to folder.html with the <details> element open so that it can show the form errors :/
    - what kind of errors can occur anyway?
genuinely shook at "webkitdirectory", "mozdirectory" and "multiple" attributes (how they make multi-uploads so easy)
TODO: rename.go is a POST-only action, because it is only available in file.html as a separate dropdown next to the filename. As in, the button is next to the filename and it opens a dropdown exposing an <input> and <button> for creating a POST request to /admin/rename/.

what am I conflicted about? I can't have an icon per action - not enough space (I do *not* want to overflow an iPhone SE width!)
I don't have any good categorization
ugly child - regenerate site and search are not dropdowns, they're straight up links. But if I make them links without any text, it becomes too easy to fat finger and accidentally incur the cost of regenerating your site on accident.
    - search is a dropdown input
    - regenerate site is uhhh
        - I need to figure out what the UI for informing the user a template was found to be broken during rendering looks like
        - Since createpost.html/createpage.html/createfile.html no longer have textarea inputs, almost all errors will be surfaced in file.html.
        - file.html's alert only shows if saving the actual file was successful or not.
        - any template rendering errors will be displayed in a separate red box that doesn't look like an alert to make it clear it isn't something dismissable -- you have to fix this now
            - This same red box will appear in folder.html if the user selects a bunch of posts/pages and clicks "regenerate"
            - btw, the "regenerate" option is now beside every page and post (and folders containing pages and posts). It is no longer a top level action, so no worries about what icon to use for that.
- To make things simpler, cut/copy/paste only work within the same top-level folder (notes, pages, posts, output).
- conservative rendering:
    - if a page is updated, only the page is regenerated.
    - if a post is updated, only the post is regenerated.
    - if a post is added or deleted, only the list page is regenerated.
    - if a list page template is updated (deleting it only means we fallback to the default posts.html), only the list page is regenerated
    - if some rando template is updated, nothing is regenerated (we don't know which page or post will reference that template so it's up to the user to manually select the pages to regenerate)
    - if some rando markdown file under a page is updated, nothing is regenerated (we don't know whether the page will reference a markdown file so it's up to the user to manually select the pages to regenerate (in the case of a documentation, they can select the entire folder and regenerate it).
    - should folder regeneration be recursive? yes.
- whether or not index.html is gzipped, we will never full-text index it! We index pages, we index templates, we index markdown files, but never the generated index.html files because it would result in duplicate entries showing up.
    - maybe we should rethink the "smart" feature of auto falling back to gzipped files for users because it makes the prospect of editing them a little murky
        - users can upload gzipped files
        - we can let users edit gzipped files (since we will unzip them for them to see, no reason to not translate whatever they typed back into a gzipped file)
        - do we want to act like a gzip service for files magically labelled as *.gz?
        - how much space savings do we even think users will save by uploading a gzipped file instead of just typing it in? text consumes barely anything, images and videos contain everything.

TODO: figure out where certmagic places its certificates so that it would solve the problem of people complaining that they cannot install their own custom certificates. By default main.go will configure this to be inside the config directory, instead

- updated icons
    CLIPBOARD => view/paste/clear
    SORT => date created/date updated/name | ascending/descending
    root/ => CLIPBOARD, gear (regenerate site), plus (create post, create site)
    notes/ => CLIPBOARD, SORT, gear (search), plus (create note, create folder)
    pages/ => CLIPBOARD, SORT, gear (search), plus (create page, create folder) (create file, upload file option is inside the page editing page itself, which is actually linked to the output directory)
    posts/ => CLIPBOARD, SORT, gear (search), plus (create post, create folder) (create file, upload file option is inside the post editing page itself itself, which is actually linked to the output directory)
    output/ => CLIPBOARD, SORT, gear (search), plus (create file?ext=html, upload file, create folder)
- asset manager in the page and post editing page is a grid of files (either the image preview or a file icon and the possibly-truncated name). The last tile contains links to both "create file" and "upload file".
    - each tile contains "insert" which inserts an <img>, <script> or <style> into where the current cursor is or the end of the document if the editor is unfocused.
    - "rename" is an action inside of the file viewer itself, not the folder viewer. You can't apply rename to multiple files so it makes no sense
    - It kind of sucks that you need to be redirected to a new page just to upload a file instead of doing it on the spot like funnyjunk. Should the upload page also show the available assets in a grid to let users track what they have uploaded so far?
    - a lot of problems would be solved if the output folder unconditionally allowed creating and uploading arbitrary files (with the allowed extensions of course). So anytime we need to link the user to a page where they can create or upload a file (in the page/post asset manager), we just link them to the corresponding folder in the output directory. Which means the output folder always needs a link to get back to the source post or page that it is derived from.
- I don't know how to continue. I don't know how to plan. Should you be able to add notes anymore from the root folder? Or is it more like a page where it is context-dependent so you have to navigate to a folder before you can create items in it? So I can only add posts from the root folder? Should I remove that as well? Only left with create site? But people will barely create sites so is it worth putting that action so prominently?
- I feel like a lot of problems would be alleviated if I had a more general-purpose icon that I could use to stuff all miscellaneous actions into like "create note" or "create post" or "regenerate site".
    - Maybe that's the key? At maximum we will only ever have 3 icons on top: clipboard (cut/copy/paste), sort by (plus previous/next pagination buttons below), hamburger menu (everything else).
- each post/page has a "view post/view page" link up top.
- remove 'admin' from file.html, now it looks like <- back | posts | view | output
- the universally allowed filetypes: .html .css .js .md .txt
    - however, anything other than .md and .txt is ignored in posts/
    - however, anything other than .md and .txt is ignored in posts/
- IDEA: "Create file" -> Display a create file page where you ask for the name as well as a dropdown with .html, .css, .js or .md (you can set the default value with a query param).
    - Change whatever the user types to be url safe, then create a post by that name as well as an output folder in output/, then redirect to the newly create page source file.
    - Since we now know the file extension, we don't have to guess which extension to apply. The correct codemirror extension is loaded when the page renders.
    - Since we now have an output folder in the output/ directory, any images or videos the user uploads goes straight into that output folder
        - When they rename the post name, the output folder name is renamed as well requiring no URL change since the images are referenced locally <img src="bird.jpg">.
- I suspect all of notebrew's features is sufficient to recreate https://kansai-odyssey.com
- notes now allow all file types (identical to themes/ but private), so .html .css .js .md .txt + any image you can upload

universal addressing system: omg maybe anything that starts with /themes/**/*.html is considered to be sourced from the themes folder, while any bare *.html is sourced from the current folder. You are not allowed to reference any other page's templates.
{{ template "/themes/common.html" }}
{{ template "common.html" }} // NOT ALLOWED! Because it would violate the global addressability of templates making it impossible to cache (common.html does not mean common.html everywhere)
{{ markdown "/themes/about-me.md" }}
{{ markdown "content.md" }}
<img src="/themes/bird.jpg"></img>
<img src="bird.jpg"></img>
![](/themes/bird.jpg)
![](bird.jpg)
{{ template "/themes/github.com/bokwoon95/plainsimple/file.html" }}

notebrew-config/503.html => 503 The server is down for maintenance

rename any image with the suffix *-original.<ext> and notebrew will honour it by not compressing the image
image compression is done immediately on demand so users are responsible for babysitting the upload and monitoring its compression status (no queue system needed, if upload or compression fails the user is notified and that's it)

default dir: $HOME/notebrew-admin
default config? $HOME/notebrew-config
notebrew.db lives in uh ~/notebrew-config? ~/notebrew-admin? ~/notebrew.db?
notebrew-config.txt => ~/Dropbox/notebrew-config/

static/dynamic private/public config:
- static private: database.json, dns01.json, smtp.json, s3.json
- static public: admin-folder.txt domain.txt, content-domain.txt, multisite.txt
- dynamic private: captcha.json
- dynamic public: allow-signup.txt

important: notebrew ip which gets the ip address of the current machine. this is so that users can add their A/AAAA records accordingly. Actually, this means we can double check the dns resolution ourselves on startup and inform the user if the domain name they provided does not point to the ip address of the current machine. BUT not on startup, but rather as a separate subcommand. In fact, we can bury it within the config subcommand? If a user provides a domain name and dns doesnt resolve to the current machine we will straight up fail. Advanced users can bypass this by writing the config json directly instead of relying on the subcommand.
notebrew config
Ctrl+C to stop anytime. Press enter without typing anything if you are satisfied with the current (or default) value.
config folder?
admin folder? (the admin folder is where X are stored. the current value is)
configure database? (database currently not configured):
    database dialect?
    sqlite file location?
    database host?
    database port?
    database user?
    database name?
    database password?
domain?
content domain? (content domain is currently not configured):
multisite?
dns01 (y/n)? (always show this if the domain is public and multisite is enabled. sanity check to make sure the api keys are valid or else fail this step)
allow signups?
captcha (y/n)?
    captcha site key?
    captcha secret key?
s3 (y/n)? (if s3 not configured and the admin-folder is the database, use ~/notebrew-objects instead)
smtp (y/n)?

dialect
user
password
host
port
dbname
sslmode

== rss reader ==

I still don't know what people want from an RSS reader. I don't even know what I want because I've never used an RSS reader. But to get a good idea you can google "google reader adds search" and find all the blog posts talking about it. Quite often, it would involve people talking about the features Google Reader had and bemoaning that it still doesn't have search.

TODO: come up with a good set of utility functions that seamlessly represent file operations so that you can queue them up effortlessly to use for testing ("first create this file, then create this folder, then..." etc). We need to do a lot of file operations to replicate the use cases we are testing, so better make this painless (and readable!)
TODO: mailer.json instead of mailer.txt, that way users don't have to urlencode their password to put it in the smtp URL.
TODO: what may a user want to display in a posts.html? A daily comic series, photography showcase, full blown posts, etc? We never let the user make an N+1 query, whatever fields they want must be supplied inside the call to getPosts. They get to cap how many posts are displayed per page via pagination.json/rss.json (ugh) in the category folder, which is stored in the files.data field.

notebrew encrypt -key $KEY $MESSAGE
notebrew decrypt
notebrew decrypt 'ABCDEFHGH' | notebrew
notebrew -config '{"domain":"bokwoon.com"}'
notebrew -config $(cat config.json | notebrew decrypt -key $NOTEBREW_SECRET_KEY)

-dir :database: -database "$HOME/notebrew.db" -multisite subdomain -address notebrew.com,notebrew.io

www.nbrew.io nuances
- only serves stuff in {sitePrefix}/output/themes
- if requested URL is a HTML page, issue a permanent redirect to that site's URL instead
- this is to prevent the same page from being available on multiple sources e.g. www.nbrew.io/@bokwoon and bokwoon.nbrew.io
- cdn.nbrew.io behaves identically to www.nbrew.io except cdn.nbrew.io may use a DNS CNAME record to point it to an actual CDN URL. If no CDN service is set up, cdn.nbrew.io gracefully degrades to serving files identical to www.nbrew.io.

nbrew.io/themes/ => https://cdn.nbrew.io/themes/
bokwoon.nbrew.io/themes/ => https://cdn.nbrew.io/@bokwoon/themes/ # Set CORS to only allow bokwoon.nbrew.io!
bokwoon.com/themes/ => https://cdn.nbrew.io/bokwoon.com/themes/ # Set CORS to only allow bokwoon.com!

principle: Give me compute, give me storage, I'll give you a working program
Must be usable with JavaScript disabled (aim for a pure HTML workflow with JS enhancements)
Strive to be efficient so more users can be packed into a single cheap server. If a feature and server efficiency are at odds, always pick server efficiency at the expense of user convenience.
Be as hands-off as possible. Avoid task queues because they have to be babysitted (what if a task fails? what if it takes too long? Request, response, that's it)
notebrew reader (rss)
notebrew accountant (expense tracker)
